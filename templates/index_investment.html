<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Investment Analysis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .card { box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); margin-bottom: 20px; }
        .positive { color: #28a745; }
        .negative { color: #dc3545; }
        .loading { display: none; }
        .scenario-box { padding: 15px; margin: 10px 0; border-radius: 8px; text-align: center; }
        .best-case { background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); border: 2px solid #28a745; }
        .average-case { background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%); border: 2px solid #17a2b8; }
        .worst-case { background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%); border: 2px solid #dc3545; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="card">
            <div class="card-header bg-primary text-white text-center">
                <h1>üìä Stock Investment Analysis</h1>
                <p class="mb-0">Professional-grade 3-month price targets and risk assessment</p>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5>üéØ Stock Analysis</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="stockSymbol" class="form-label">Enter Stock Symbol:</label>
                            <input type="text" class="form-control" id="stockSymbol" 
                                   placeholder="e.g., AAPL, GOOGL, MSFT, TSLA" 
                                   onkeypress="handleKeyPress(event)">
                        </div>
                        <button class="btn btn-primary w-100" onclick="analyzeStock()">
                            Analyze Investment üìà
                        </button>
                        
                        <div class="mt-3 p-3 bg-light rounded">
                            <small>
                                <strong>Analysis includes:</strong><br>
                                ‚Ä¢ Best/Average/Worst case scenarios<br>
                                ‚Ä¢ Risk assessment & confidence scores<br>
                                ‚Ä¢ Professional-grade price targets<br>
                                ‚Ä¢ Historical trend analysis
                            </small>
                        </div>
                        
                        <div id="loading" class="text-center loading">
                            <div class="spinner-border text-primary mt-3" role="status"></div>
                            <p class="mt-2">Analyzing investment scenarios...</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-8">
                <div id="results" style="display: none;"></div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-body">
                <p class="text-muted small text-center mb-0">
                    <strong>‚ö†Ô∏è Disclaimer:</strong> This analysis is for educational purposes only. 
                    Past performance does not guarantee future results. Always consult with a financial advisor.
                </p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                analyzeStock();
            }
        }

        async function analyzeStock() {
            const symbol = document.getElementById('stockSymbol').value.trim().toUpperCase();
            if (!symbol) { alert('Please enter a stock symbol'); return; }

            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ symbol: symbol })
                });

                const data = await response.json();
                document.getElementById('loading').style.display = 'none';
                
                if (data.success) {
                   displayInvestmentResults(data.result);
               } else {
                   displayError(data.error);
               }
           } catch (error) {
               document.getElementById('loading').style.display = 'none';
               displayError('Network error: ' + error.message);
           }
       }

       function displayInvestmentResults(result) {
           const html = `
               <div class="card">
                   <div class="card-header">
                       <h4>üìä ${result.symbol} Investment Analysis</h4>
                       <small class="text-muted">${result.data_freshness}</small>
                   </div>
                   <div class="card-body">
                       <!-- Current Price & Target Date -->
                       <div class="row mb-4">
                           <div class="col-md-6">
                               <h6>Current Price</h6>
                               <h3>$${result.current_price}</h3>
                               <small class="text-muted">As of ${result.current_date}</small>
                           </div>
                           <div class="col-md-6">
                               <h6>Target Date</h6>
                               <h3>${result.prediction_date_short}</h3>
                               <small class="text-muted">3-Month Outlook</small>
                           </div>
                       </div>

                       <!-- Price Target Scenarios -->
                       <h5 class="mb-3">üéØ Price Target Scenarios</h5>
                       <div class="row">
                           <div class="col-md-4">
                               <div class="scenario-box best-case">
                                   <h6 class="text-success mb-2">üìà Best Case (Bull)</h6>
                                   <h4 class="text-success">$${result.best_case_price}</h4>
                                   <p class="mb-0 text-success">${result.best_case_change >= 0 ? '+' : ''}${result.best_case_change}%</p>
                                   <small>Upside Potential</small>
                               </div>
                           </div>
                           <div class="col-md-4">
                               <div class="scenario-box average-case">
                                   <h6 class="text-info mb-2">üìä Average Case (Neutral)</h6>
                                   <h4 class="text-info">$${result.average_case_price}</h4>
                                   <p class="mb-0 text-info">${result.average_case_change >= 0 ? '+' : ''}${result.average_case_change}%</p>
                                   <small>Expected Return</small>
                               </div>
                           </div>
                           <div class="col-md-4">
                               <div class="scenario-box worst-case">
                                   <h6 class="text-danger mb-2">üìâ Worst Case (Bear)</h6>
                                   <h4 class="text-danger">$${result.worst_case_price}</h4>
                                   <p class="mb-0 text-danger">${result.worst_case_change >= 0 ? '+' : ''}${result.worst_case_change}%</p>
                                   <small>Downside Risk</small>
                               </div>
                           </div>
                       </div>

                       <!-- Risk Assessment -->
                       <div class="row mt-4">
                           <div class="col-md-6">
                               <div class="card border-warning">
                                   <div class="card-body">
                                       <h6>‚ö†Ô∏è Risk Assessment</h6>
                                       <p><strong>Risk Level:</strong> ${result.risk_level}</p>
                                       <p><strong>Volatility:</strong> ${result.volatility_score}%</p>
                                       <p><strong>Model Confidence:</strong> ${result.confidence}%</p>
                                   </div>
                               </div>
                           </div>
                           <div class="col-md-6">
                               <div class="card border-info">
                                   <div class="card-body">
                                       <h6>üí° Investment Summary</h6>
                                       <p><strong>Expected Return:</strong> ${result.expected_return >= 0 ? '+' : ''}${result.expected_return}%</p>
                                       <p><strong>Upside Potential:</strong> +${result.upside_potential}%</p>
                                       <p><strong>Downside Risk:</strong> -${result.downside_risk}%</p>
                                   </div>
                               </div>
                           </div>
                       </div>

                       <!-- Chart -->
                       ${result.chart ? `
                       <div class="mt-4">
                           <h6>üìà Price Analysis & Targets</h6>
                           <div class="text-center">
                               <img src="data:image/png;base64,${result.chart}" class="img-fluid" alt="Investment Analysis Chart" style="max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 8px;">
                           </div>
                       </div>
                       ` : ''}
                       
                       <div class="mt-3">
                           <small class="text-muted">
                               <strong>Model:</strong> ${result.model_type} ‚Ä¢ 
                               <strong>Data Points:</strong> ${result.data_points} days ‚Ä¢ 
                               <strong>Analysis Date:</strong> ${result.current_date}
                           </small>
                       </div>
                   </div>
               </div>
           `;
           
           document.getElementById('results').innerHTML = html;
           document.getElementById('results').style.display = 'block';
       }

       function displayError(error) {
           const html = `
               <div class="alert alert-danger">
                   <h6>‚ùå Analysis Error</h6>
                   <p>${error}</p>
                   <small>Try a different stock symbol or check your internet connection.</small>
               </div>
           `;
           document.getElementById('results').innerHTML = html;
           document.getElementById('results').style.display = 'block';
       }
   </script>
</body>
</html>
